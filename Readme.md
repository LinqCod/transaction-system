# Transaction Service

Сервис транзакций

## Старт сервиса

1. Клонируем репозиторий проекта:
```
git clone https://github.com/LinqCod/transaction-system.git
```
2. Дальше необходимо запустить само приложение. Сервис основан на технологии jetstream, по этой причине для консьюмера и паблишера созданы отдельные сервисы, обернутые в докер контейнеры. Для развертывания которого использовался `docker-compose`. Помимо контейнеров сервисов поднимаются также контейнеры с postgres, nats (с активизацией jetstream).

### Команды

Для запуска сервиса достаточно использовать команду `make service-up`, которая сбилдит и запустит приложение, доступное на порту 8080:

```
make service-up
```

Для завершения работы сервиса следует воспользоваться командой:

```
make service-down
```

## Эндпоинты

* POST /api/v1/accounts/invoice - Выполняет пополнение средств на аккаунт (принимает json объект в формате {"card_number": "value", "currency": "value", "amount": "value"})
* POST /api/v1/accounts/withdraw - Выполняет снятие средств с аккаунта (принимает json объект в формате {"card_number": "value", "currency": "value", "amount": "value"})
* GET /api/v1/accounts/ - Получение актуального и замороженного балансов каждого аккаунта

## Возникшие вопросы и выбранные способы их решения:
1. При добавлении средств на аккаунт пользователя имеется возможность выбора курса валюты, которую кладешь. Соответственно, вопрос в том, как хранить эти деньги. Было решено хранить все деньги на аккаунте в российских рублях, переводя деньги по соответсвующему курсу (используется сторонний сервис курсов валют).
2. По второй ручке (Withdraw) несовсем понятно, что имеется ввиду под "номер кошелька или карты куда зачисляются средства", по смыслу пункта тз решено было, что, вероятно, это опечатка, и имелся ввиду счет, с которого средства необходимо снять (соответственно, реализованно таким образом).
3. Конечные статусы транзакций решено выводить в логи (возможно, имелось ввиду хранение истории транзакций, но по тз неоднозначно).
4. Поскольку ручки для создания банковского аккаунта не предусмотрено, для простоты было решено добавить несколько учетных записей в таблицу бд при помощи init.sql файла, который запускается при старте контейнера бд.
5. В качестве актуального и замороженного балансов в таблице accounts было решено создать два отдельных поля balance и frozen_balance соответственно. Изза небольшой неопределенности в тз решил обрабатывать замороженный баланс следующим образом:
   * при создании транзакции пополнения счета на замороженный баланс добавляются средства, данные пользователем. Далее транзакция отправляется в message queue со статусом "Created". Как только транзакция будет обработана консьюмером, средства будут сняты с замороженного баланса и, в случае успешной транзакции, добавлены на основной счет.
   * соответственно, для получения списков актуального и замороженного балансов пользователей была создана ручка "accounts/" которая формирует JSON с данными всех аккаунтов на текущий момент.
